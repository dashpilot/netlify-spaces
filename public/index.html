<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>Untitled Document</title>

    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Netlify Identity Widget -->
    <script type="text/javascript" src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>

<body>
    <div class="container text-center mt-5">
        <button class="btn btn-outline-dark" id="save" style="display: none;">
        Save
      </button>
    </div>
    <div class="container" id="result"></div>

    <script>
        const saveBut = document.querySelector("#save");

        netlifyIdentity.on("login", function(user) {
            console.log(user);
            saveBut.style.display = "block";
            saveBut.addEventListener("click", function() {
                save();
            });
        });

        async function save() {
            const token = await netlifyIdentity.currentUser().jwt();
            let user = await netlifyIdentity.currentUser();

            let data = {
                title: "Hello world. This is some text.",
            };

            const response = await fetch("/.netlify/functions/save", {
                headers: {
                    Authorization: `Bearer ${token}`,
                },
                method: "post",
                body: JSON.stringify({
                    data: data,
                    type: "json",
                }),
            }).then(function(res) {
                document.querySelector("#result").innerHTML = "Succes!";
            });
        }
    </script>
</body>

</html>